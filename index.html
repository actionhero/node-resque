<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>node-resque</title><meta name="description" content="Documentation for node-resque"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">node-resque</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>node-resque</h1></div><div class="tsd-panel tsd-typography"><h1 id="node-resque-the-best-background-jobs-in-node" class="tsd-anchor-link">node-resque: The best background jobs in node.<a href="#node-resque-the-best-background-jobs-in-node" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p><strong>Distributed delayed jobs in nodejs</strong>. Resque is a background job system backed by <a href="http://redis.io">Redis</a> (version 2.6.0 and up required). It includes priority queues, plugins, locking, delayed jobs, and more! This project is a very opinionated but API-compatible with <a href="https://github.com/resque/resque">Resque</a> and <a href="http://sidekiq.org/">Sidekiq</a> (<a href="https://github.com/actionhero/node-resque/issues/311">caveats</a>). We also implement some of the popular Resque plugins, including <a href="https://github.com/resque/resque-scheduler">resque-scheduler</a> and <a href="https://github.com/lantins/resque-retry">resque-retry</a></p>
<p>The full API documentation for this package is automatically generated from the <code>main</code> via <a href="https://typedoc.org">typedoc</a> branch and published to <a href="https://node-resque.actionherojs.com/">https://node-resque.actionherojs.com/</a></p>
<p><a href="https://npmjs.org/package/node-resque"><img src="https://nodei.co/npm/node-resque.png?downloads=true" alt="Nodei stats"></a></p>
<p><img src="https://github.com/actionhero/node-resque/workflows/Test/badge.svg" alt="Test"></p>
<h2 id="the-resque-factory-how-it-works" class="tsd-anchor-link">The Resque Factory (How It Works)<a href="#the-resque-factory-how-it-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Resque is a queue based task processing system that can be thought of as a &quot;Kanban&quot; style factory. Workers in this factory can each only work one Job at a time. They pull Jobs from Queues and work them to completion (or failure). Each Job has two parts: instructions on how to complete the job (the <code>perform</code> function), and any inputs necessary to complete the Job.</p>
<h3 id="queues" class="tsd-anchor-link">Queues<a href="#queues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>In our factory example, Queues are analogous to conveyor belts. Jobs are placed on the belts (Queues) and are held in order waiting for a Worker to pick them up. There are three types of Queues: regular work Queues, Delayed Job Queues, and the Failed Job Queue. The Delayed Job Queues contains Job definitions that are intended to be worked at or in a specified time. The Failed Job Queue is where Workers place any Jobs that have failed during execution.</p>
<h3 id="workers" class="tsd-anchor-link">Workers<a href="#workers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Our Workers are the heart of the factory. Each Worker is assigned one or more Queues to check for work. After taking a Job from a Queue the Worker attempts to complete the Job. If successful, they go back to check out more work from the Queues. However, if there is a failure, the Worker records the job and its inputs in the Failed Jobs Queue before going back for more work.</p>
<h3 id="scheduler" class="tsd-anchor-link">Scheduler<a href="#scheduler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The Scheduler can be thought of as a specialized type of Worker. Unlike other Workers, the Scheduler does not execute any Jobs, instead it manages the Delayed Job Queue. As Job definitions are added to the Delayed Job Queue they must specify when they can become available for execution. The Scheduler constantly checks to see if any Delayed Jobs are ready to execute. When a Delayed Job becomes ready for execution the Scheduler places a new instance of that Job in its defined Queue.</p>
<h2 id="api-docs" class="tsd-anchor-link">API Docs<a href="#api-docs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>You can read the API docs for Node Resque @ <a href="https://node-resque.actionherojs.com">node-resque.actionherojs.com</a>. These are generated automatically from the master branch via <a href="https://typedoc.org/">TypeDoc</a></p>
<h2 id="version-notes" class="tsd-anchor-link">Version Notes<a href="#version-notes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li>The version of redis required is &gt;= 2.6.0 as we use lua scripting to create custom atomic operations</li>
<li>‼️ Version 6+ of Node Resque uses TypeScript. We will still include JavaScript transpiled code in NPM releases, but they will be generated from the TypeScript source. Functionality between node-resque v5 and v6 should be the same.</li>
<li>‼️ Version 5+ of Node Resque uses async/await. There is no upgrade path from previous versions. Node v8.0.0+ is required.</li>
</ul>
<h2 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>I learn best by examples:</p>
<pre><code class="javascript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Worker</span><span class="hl-1">, </span><span class="hl-2">Plugins</span><span class="hl-1">, </span><span class="hl-2">Scheduler</span><span class="hl-1">, </span><span class="hl-2">Queue</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;node-resque&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-5">boot</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-6">// ////////////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// SET UP THE CONNECTION //</span><br/><span class="hl-1">  </span><span class="hl-6">// ////////////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">connectionDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-2">pkg:</span><span class="hl-1"> </span><span class="hl-3">&quot;ioredis&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">host:</span><span class="hl-1"> </span><span class="hl-3">&quot;127.0.0.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-4">null</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-8">6379</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">database:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">// namespace: &#39;resque&#39;,</span><br/><span class="hl-1">    </span><span class="hl-6">// looping: true,</span><br/><span class="hl-1">    </span><span class="hl-6">// options: {password: &#39;abc&#39;},</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// ///////////////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// DEFINE YOUR WORKER TASKS //</span><br/><span class="hl-1">  </span><span class="hl-6">// ///////////////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">jobsToComplete</span><span class="hl-1"> = </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">jobs</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-2">add:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">plugins:</span><span class="hl-1"> [</span><span class="hl-2">Plugins</span><span class="hl-1">.</span><span class="hl-2">JobLock</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">pluginOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">JobLock:</span><span class="hl-1"> { </span><span class="hl-2">reEnqueue:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1"> },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-5">perform</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">((</span><span class="hl-2">resolve</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">setTimeout</span><span class="hl-1">(</span><span class="hl-2">resolve</span><span class="hl-1">, </span><span class="hl-8">1000</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-2">jobsToComplete</span><span class="hl-1">--;</span><br/><span class="hl-1">        </span><span class="hl-5">tryShutdown</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">answer</span><span class="hl-1"> = </span><span class="hl-2">a</span><span class="hl-1"> + </span><span class="hl-2">b</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">subtract:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">perform</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">jobsToComplete</span><span class="hl-1">--;</span><br/><span class="hl-1">        </span><span class="hl-5">tryShutdown</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">answer</span><span class="hl-1"> = </span><span class="hl-2">a</span><span class="hl-1"> - </span><span class="hl-2">b</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// just a helper for this demo</span><br/><span class="hl-1">  </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-5">tryShutdown</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">jobsToComplete</span><span class="hl-1"> === </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">((</span><span class="hl-2">resolve</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">setTimeout</span><span class="hl-1">(</span><span class="hl-2">resolve</span><span class="hl-1">, </span><span class="hl-8">500</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-5">exit</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// /////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// START A WORKER //</span><br/><span class="hl-1">  </span><span class="hl-6">// /////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">worker</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Worker</span><span class="hl-1">(</span><br/><span class="hl-1">    { </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">, </span><span class="hl-2">queues:</span><span class="hl-1"> [</span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;otherQueue&quot;</span><span class="hl-1">] },</span><br/><span class="hl-1">    </span><span class="hl-2">jobs</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// ////////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// START A SCHEDULER //</span><br/><span class="hl-1">  </span><span class="hl-6">// ////////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">scheduler</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Scheduler</span><span class="hl-1">({ </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// //////////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// REGISTER FOR EVENTS //</span><br/><span class="hl-1">  </span><span class="hl-6">// //////////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;start&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker started&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;end&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker ended&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;cleaning_worker&quot;</span><span class="hl-1">, (</span><span class="hl-2">worker</span><span class="hl-1">, </span><span class="hl-2">pid</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`cleaning old worker </span><span class="hl-4">${</span><span class="hl-2">worker</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;poll&quot;</span><span class="hl-1">, (</span><span class="hl-2">queue</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`worker polling </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;ping&quot;</span><span class="hl-1">, (</span><span class="hl-2">time</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`worker check in @ </span><span class="hl-4">${</span><span class="hl-2">time</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;job&quot;</span><span class="hl-1">, (</span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`working job </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><span class="hl-2">job</span><span class="hl-10">)</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;reEnqueue&quot;</span><span class="hl-1">, (</span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">plugin</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`reEnqueue job (</span><span class="hl-4">${</span><span class="hl-2">plugin</span><span class="hl-4">}</span><span class="hl-3">) </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><span class="hl-2">job</span><span class="hl-10">)</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;success&quot;</span><span class="hl-1">, (</span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">result</span><span class="hl-1">, </span><span class="hl-2">duration</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">`job success </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><br/><span class="hl-10">        </span><span class="hl-2">job</span><span class="hl-10">,</span><br/><span class="hl-10">      )</span><span class="hl-4">}</span><span class="hl-3"> &gt;&gt; </span><span class="hl-4">${</span><span class="hl-2">result</span><span class="hl-4">}</span><span class="hl-3"> (</span><span class="hl-4">${</span><span class="hl-2">duration</span><span class="hl-4">}</span><span class="hl-3">ms)`</span><span class="hl-1">,</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;failure&quot;</span><span class="hl-1">, (</span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">failure</span><span class="hl-1">, </span><span class="hl-2">duration</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">`job failure </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><br/><span class="hl-10">        </span><span class="hl-2">job</span><span class="hl-10">,</span><br/><span class="hl-10">      )</span><span class="hl-4">}</span><span class="hl-3"> &gt;&gt; </span><span class="hl-4">${</span><span class="hl-2">failure</span><span class="hl-4">}</span><span class="hl-3"> (</span><span class="hl-4">${</span><span class="hl-2">duration</span><span class="hl-4">}</span><span class="hl-3">ms)`</span><span class="hl-1">,</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`error </span><span class="hl-4">${</span><span class="hl-2">queue</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><span class="hl-2">job</span><span class="hl-10">)</span><span class="hl-4">}</span><span class="hl-3">  &gt;&gt; </span><span class="hl-4">${</span><span class="hl-2">error</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;pause&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker paused&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;start&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;scheduler started&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;end&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;scheduler ended&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;poll&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;scheduler polling&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;leader&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;scheduler became leader&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`scheduler error &gt;&gt; </span><span class="hl-4">${</span><span class="hl-2">error</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;cleanStuckWorker&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerName</span><span class="hl-1">, </span><span class="hl-2">errorPayload</span><span class="hl-1">, </span><span class="hl-2">delta</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">`failing </span><span class="hl-4">${</span><span class="hl-2">workerName</span><span class="hl-4">}</span><span class="hl-3"> (stuck for </span><span class="hl-4">${</span><span class="hl-2">delta</span><span class="hl-4">}</span><span class="hl-3">s) and failing job </span><span class="hl-4">${</span><span class="hl-2">errorPayload</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">,</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;workingTimestamp&quot;</span><span class="hl-1">, (</span><span class="hl-2">timestamp</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`scheduler working timestamp </span><span class="hl-4">${</span><span class="hl-2">timestamp</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;transferredJob&quot;</span><span class="hl-1">, (</span><span class="hl-2">timestamp</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`scheduler enquing job </span><span class="hl-4">${</span><span class="hl-2">timestamp</span><span class="hl-4">}</span><span class="hl-3"> &gt;&gt; </span><span class="hl-4">${</span><span class="hl-7">JSON</span><span class="hl-10">.</span><span class="hl-5">stringify</span><span class="hl-10">(</span><span class="hl-2">job</span><span class="hl-10">)</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// //////////////////////</span><br/><span class="hl-1">  </span><span class="hl-6">// CONNECT TO A QUEUE //</span><br/><span class="hl-1">  </span><span class="hl-6">// //////////////////////</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Queue</span><span class="hl-1">({ </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1"> }, </span><span class="hl-2">jobs</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">function</span><span class="hl-1"> (</span><span class="hl-2">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-2">error</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">enqueue</span><span class="hl-1">(</span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;add&quot;</span><span class="hl-1">, [</span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">enqueue</span><span class="hl-1">(</span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;add&quot;</span><span class="hl-1">, [</span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">enqueue</span><span class="hl-1">(</span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;add&quot;</span><span class="hl-1">, [</span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">enqueueIn</span><span class="hl-1">(</span><span class="hl-8">3000</span><span class="hl-1">, </span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;subtract&quot;</span><span class="hl-1">, [</span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><span class="hl-2">jobsToComplete</span><span class="hl-1"> = </span><span class="hl-8">4</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">boot</span><span class="hl-1">();</span><br/><br/><span class="hl-6">// and when you are done</span><br/><span class="hl-6">// await queue.end()</span><br/><span class="hl-6">// await scheduler.end()</span><br/><span class="hl-6">// await worker.end()</span>
</code><button type="button">Copy</button></pre>

<h2 id="node-resque-interfaces-queue-worker-and-scheduler" class="tsd-anchor-link">Node Resque Interfaces: Queue, Worker, and Scheduler<a href="#node-resque-interfaces-queue-worker-and-scheduler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>There are 3 main classes in <code>node-resque</code>: Queue, Worker, and Scheduler</p>
<ul>
<li><strong>Queue</strong>: This is the interface your program uses to interact with resque's queues - to insert jobs, check on the performance of things, and generally administer your background jobs.</li>
<li><strong>Worker</strong>: This interface is how jobs get processed. Workers are started and then they check for jobs enqueued into various queues and complete them. If there's an error, they write to the <code>error</code> queue.
<ul>
<li>There's a special class called <code>multiWorker</code> in Node Resque which will run many workers at once for you (see below).</li>
</ul>
</li>
<li><strong>Scheduler</strong>: The scheduler can be thought of as the coordinator for Node Resque. It is primarily in charge of checking when jobs told to run later (with <code>queue.enqueueIn</code> or <code>queue.enqueueAt</code>) should be processed, but it performs some other jobs like checking for 'stuck' workers and general cluster cleanup.
<ul>
<li>You can (and should) run many instances of the scheduler class at once, but only one will be elected to be the 'leader', and actually do work.</li>
<li>The 'delay' defined on a scheduled job does not specify when the job should be run, but rather when the job should be enqueued. This means that <code>node-resque</code> can not guarantee when a job is going to be executed, only when it will become <em>available</em> for execution (added to a Queue).</li>
</ul>
</li>
</ul>
<h2 id="configuration-options" class="tsd-anchor-link">Configuration Options:<a href="#configuration-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li><code>new queue</code> requires only the &quot;queue&quot; variable to be set. If you intend to run <a href="#plugins">plugins</a> with <code>beforeEnqueue</code> or <code>afterEnqueue</code> hooks, you should also pass the <code>jobs</code> object to it.</li>
<li><code>new worker</code> has some additional options:</li>
</ul>
<pre><code class="javascript"><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">looping:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">timeout:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">queues:</span><span class="hl-1"> </span><span class="hl-3">&quot;*&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-2">os</span><span class="hl-1">.</span><span class="hl-5">hostname</span><span class="hl-1">() + </span><span class="hl-3">&quot;:&quot;</span><span class="hl-1"> + </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">pid</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>Note that when using <code>&quot;*&quot;</code> queue:</p>
<ul>
<li>there's minor performance impact for checking the queues</li>
<li>queues are processed in undefined order</li>
</ul>
<p>The configuration hash passed to <code>new NodeResque.Worker</code>, <code>new NodeResque.Scheduler</code> or <code>new NodeResque.Queue</code> can also take a <code>connection</code> option.</p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">connectionDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">pkg:</span><span class="hl-1"> </span><span class="hl-3">&quot;ioredis&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">host:</span><span class="hl-1"> </span><span class="hl-3">&quot;127.0.0.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-8">6379</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">database:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">namespace:</span><span class="hl-1"> </span><span class="hl-3">&quot;resque&quot;</span><span class="hl-1">, </span><span class="hl-6">// Also allow array of strings</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">worker</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Worker</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">, </span><span class="hl-2">queues:</span><span class="hl-1"> </span><span class="hl-3">&quot;math&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-2">jobs</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// handler errors</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span><br/><br/><span class="hl-6">// and when you are done</span><br/><span class="hl-6">// await worker.end()</span>
</code><button type="button">Copy</button></pre>

<p>You can also pass redis client directly.</p>
<pre><code class="javascript"><span class="hl-6">// assume you already initialized redis client before</span><br/><span class="hl-6">// the &quot;redis&quot; key can be IORedis.Redis or IORedis.Cluster instance</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">redisClient</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Redis</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">connectionDetails</span><span class="hl-1"> = { </span><span class="hl-2">redis:</span><span class="hl-1"> </span><span class="hl-2">redisClient</span><span class="hl-1"> };</span><br/><br/><span class="hl-6">// or</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">redisCluster</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Cluster</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">connectionDetails</span><span class="hl-1"> = { </span><span class="hl-2">redis:</span><span class="hl-1"> </span><span class="hl-2">redisCluster</span><span class="hl-1"> };</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">worker</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Worker</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">, </span><span class="hl-2">queues:</span><span class="hl-1"> </span><span class="hl-3">&quot;math&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-2">jobs</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, (</span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// handler errors</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span><br/><br/><span class="hl-6">// and when you are done</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">worker</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h2 id="notes" class="tsd-anchor-link">Notes<a href="#notes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li>Be sure to call <code>await worker.end()</code>, <code>await queue.end()</code> and <code>await scheduler.end()</code> before shutting down your application if you want to properly clear your worker status from resque.</li>
<li>When ending your application, be sure to allow your workers time to finish what they are working on</li>
<li>This project implements the &quot;scheduler&quot; part of rescue-scheduler (the daemon which can promote enqueued delayed jobs into the work queues when it is time), but not the CRON scheduler proxy. To learn more about how to use a CRON-like scheduler, read the <a href="#job-schedules">Job Schedules</a> section of this document.</li>
<li>&quot;Namespace&quot; is a string which is appended to the front of your keys in redis. Normally, it is &quot;resque&quot;. This is helpful if you want to store multiple work queues in one redis database. Do not use <code>keyPrefix</code> if you are using the <code>ioredis</code> (default) redis driver in this project (see <a href="https://github.com/actionhero/node-resque/issues/245">https://github.com/actionhero/node-resque/issues/245</a> for more information.)</li>
<li>If you are using any plugins which effect <code>beforeEnqueue</code> or <code>afterEnqueue</code>, be sure to pass the <code>jobs</code> argument to the <code>new NodeResque.Queue()</code> constructor</li>
<li>If a job fails, it will be added to a special <code>failed</code> queue. You can then inspect these jobs, write a plugin to manage them, move them back to the normal queues, etc. Failure behavior by default is just to enter the <code>failed</code> queue, but there are many options. Check out these examples from the ruby ecosystem for inspiration:
<ul>
<li><a href="https://github.com/lantins/resque-retry">https://github.com/lantins/resque-retry</a></li>
<li><a href="https://github.com/resque/resque/wiki/Failure-Backends">https://github.com/resque/resque/wiki/Failure-Backends</a></li>
</ul>
</li>
<li>If you plan to run more than one worker per nodejs process, be sure to name them something distinct. Names <strong>must</strong> follow the pattern <code>hostname:pid+unique_id</code>. For example:</li>
<li>For the Retry plugin, a success message will be emitted from the worker on each attempt (even if the job fails) except the final retry. The final retry will emit a failure message instead.</li>
</ul>
<p>If you want to learn more about running Node-Resque with docker, please view the examples here: <a href="https://github.com/actionhero/node-resque/tree/master/examples/docker">https://github.com/actionhero/node-resque/tree/master/examples/docker</a></p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">name</span><span class="hl-1"> = </span><span class="hl-2">os</span><span class="hl-1">.</span><span class="hl-5">hostname</span><span class="hl-1">() + </span><span class="hl-3">&quot;:&quot;</span><span class="hl-1"> + </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">pid</span><span class="hl-1"> + </span><span class="hl-3">&quot;+&quot;</span><span class="hl-1"> + </span><span class="hl-2">counter</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">worker</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Worker</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">, </span><span class="hl-2">queues:</span><span class="hl-1"> </span><span class="hl-3">&quot;math&quot;</span><span class="hl-1">, </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-2">name</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-2">jobs</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="workerperforminline" class="tsd-anchor-link">Worker#performInline<a href="#workerperforminline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p><strong>DO NOT USE THIS IN PRODUCTION</strong>. In tests or special cases, you may want to process/work a job in-line. To do so, you can use <code>worker.performInline(jobName, arguments, callback)</code>. If you are planning on running a job via #performInline, this worker should also not be started, nor should be using event emitters to monitor this worker. This method will also not write to redis at all, including logging errors, modify resque's stats, etc.</p>
<h2 id="queue-management" class="tsd-anchor-link">Queue Management<a href="#queue-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<pre><code class="js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Queue</span><span class="hl-1">({ </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">, </span><span class="hl-2">jobs</span><span class="hl-1"> });</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>API documentation for the main methods you will be using to enqueue jobs to be worked can be found @ <a href="https://node-resque.actionherojs.com">node-resque.actionherojs.com</a>.</p>
<h2 id="failed-job-management" class="tsd-anchor-link">Failed Job Management<a href="#failed-job-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>From time to time, your jobs/workers may fail. Resque workers will move failed jobs to a special <code>failed</code> queue which will store the original arguments of your job, the failing stack trace, and additional metadata.</p>
<p><img src="https://raw.githubusercontent.com/actionhero/node-resque/master/images/error_payload.png" alt="error example"></p>
<p>You can work with these failed jobs with the following methods:</p>
<p><strong><code>let failedCount = await queue.failedCount()</code></strong></p>
<ul>
<li><code>failedCount</code> is the number of jobs in the failed queue</li>
</ul>
<p><strong><code>let failedJobs = await queue.failed(start, stop)</code></strong></p>
<ul>
<li><code>failedJobs</code> is an array listing the data of the failed jobs. Each element looks like:
<code>{&quot;worker&quot;: &quot;host:pid&quot;, &quot;queue&quot;: &quot;test_queue&quot;, &quot;payload&quot;: {&quot;class&quot;:&quot;slowJob&quot;, &quot;queue&quot;:&quot;test_queue&quot;, &quot;args&quot;:[null]}, &quot;exception&quot;: &quot;TypeError&quot;, &quot;error&quot;: &quot;MyImport is not a function&quot;, &quot;backtrace&quot;: [' at Worker.perform (/path/to/worker:111:24)', ' at &lt;anonymous&gt;'], &quot;failed_at&quot;: &quot;Fri Dec 12 2014 14:01:16 GMT-0800 (PST)&quot;}</code></li>
<li>To retrieve all failed jobs, use arguments: <code>await queue.failed(0, -1)</code></li>
</ul>
<h3 id="failing-a-job" class="tsd-anchor-link">Failing a Job<a href="#failing-a-job" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>We use a try/catch pattern to catch errors in your jobs. If any job throws an
uncaught exception, it will be caught, and the job's payload moved to the error
queue for inspection.
Do not use <a href="https://nodejs.org/api/domain.html">domain</a>, <a href="https://nodejs.org/api/process.html#process_event_exit">process.on(&quot;exit&quot;)</a>, or any other method
of &quot;catching&quot; a process crash.</p>
<p>The error payload looks like:</p>
<pre><code class="javascript"><span class="hl-1">{ </span><span class="hl-11">worker</span><span class="hl-1">: </span><span class="hl-3">&#39;busted-worker-3&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">queue</span><span class="hl-1">: </span><span class="hl-3">&#39;busted-queue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">payload</span><span class="hl-1">: { </span><span class="hl-11">class</span><span class="hl-1">: </span><span class="hl-3">&#39;busted_job&#39;</span><span class="hl-1">, </span><span class="hl-11">queue</span><span class="hl-1">: </span><span class="hl-3">&#39;busted-queue&#39;</span><span class="hl-1">, </span><span class="hl-11">args</span><span class="hl-1">: [ </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1"> ] },</span><br/><span class="hl-1">  </span><span class="hl-11">exception</span><span class="hl-1">: </span><span class="hl-3">&#39;ERROR_NAME&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">error</span><span class="hl-1">: </span><span class="hl-3">&#39;I broke&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-11">failed_at</span><span class="hl-1">: </span><span class="hl-3">&#39;Sun Apr 26 2015 14:00:44 GMT+0100 (BST)&#39;</span><span class="hl-1"> }</span>
</code><button type="button">Copy</button></pre>

<p><strong><code>await queue.removeFailed(failedJob)</code></strong></p>
<ul>
<li>the input <code>failedJob</code> is an expanded node object representing the failed job, retrieved via <code>queue.failed</code></li>
</ul>
<p><strong><code>await queue.retryAndRemoveFailed(failedJob)</code></strong></p>
<ul>
<li>the input <code>failedJob</code> is an expanded node object representing the failed job, retrieved via <code>queue.failed</code></li>
<li>this method will instantly re-enqueue a failed job back to its original queue, and delete the failed entry for that job</li>
</ul>
<h2 id="failed-worker-management" class="tsd-anchor-link">Failed Worker Management<a href="#failed-worker-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="automatically" class="tsd-anchor-link">Automatically<a href="#automatically" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>By default, the scheduler will check for workers which haven't pinged redis in 60 minutes. If this happens, we will assume the process crashed, and remove it from redis. If this worker was working on a job, we will place it in the failed queue for later inspection. Every worker has a timer running in which it then updates a key in redis every <code>timeout</code> (default: 5 seconds). If your job is slow, but async, there should be no problem. However, if your job consumes 100% of the CPU of the process, this timer might not fire.</p>
<p>To modify the 60 minute check, change <code>stuckWorkerTimeout</code> when configuring your scheduler, ie:</p>
<pre><code class="js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">scheduler</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Scheduler</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">stuckWorkerTimeout:</span><span class="hl-1"> (</span><span class="hl-8">1000</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1"> * </span><span class="hl-8">60</span><span class="hl-1">) </span><span class="hl-6">// 1 hour, in ms</span><br/><span class="hl-1">  </span><span class="hl-2">connection</span><span class="hl-1">: </span><span class="hl-2">connectionDetails</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<p>Set your scheduler's <code>stuckWorkerTimeout = false</code> to disable this behavior.</p>
<pre><code class="js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">scheduler</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Scheduler</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">stuckWorkerTimeout:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1"> </span><span class="hl-6">// will not fail jobs which haven&#39;t pinged redis</span><br/><span class="hl-1">  </span><span class="hl-2">connection</span><span class="hl-1">: </span><span class="hl-2">connectionDetails</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="manually" class="tsd-anchor-link">Manually<a href="#manually" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Sometimes a worker crashes is a <em>severe</em> way, and it doesn't get the time/chance to notify redis that it is leaving the pool (this happens all the time on PAAS providers like Heroku). When this happens, you will not only need to extract the job from the now-zombie worker's &quot;working on&quot; status, but also remove the stuck worker. To aid you in these edge cases, <code>await queue.cleanOldWorkers(age)</code> is available.</p>
<p>Because there are no 'heartbeats' in resque, it is impossible for the application to know if a worker has been working on a long job or it is dead. You are required to provide an &quot;age&quot; for how long a worker has been &quot;working&quot;, and all those older than that age will be removed, and the job they are working on moved to the error queue (where you can then use <code>queue.retryAndRemoveFailed</code>) to re-enqueue the job.</p>
<p>If you know the name of a worker that should be removed, you can also call <code>await queue.forceCleanWorker(workerName)</code> directly, and that will also remove the worker and move any job it was working on into the error queue. This method will still proceed for workers which are only partially in redis, indicting a previous connection failure. In this case, the job which the worker was working on is irrecoverably lost.</p>
<h2 id="job-schedules" class="tsd-anchor-link">Job Schedules<a href="#job-schedules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>You may want to use node-resque to schedule jobs every minute/hour/day, like a distributed CRON system. There are a number of excellent node packages to help you with this, like <a href="https://github.com/tejasmanohar/node-schedule">node-schedule</a> and <a href="https://github.com/ncb000gt/node-cron">node-cron</a>. Node-resque makes it possible for you to use the package of your choice to schedule jobs with.</p>
<p>Assuming you are running node-resque across multiple machines, you will need to ensure that only one of your processes is actually scheduling the jobs. To help you with this, you can inspect which of the scheduler processes is currently acting as leader, and flag only the master scheduler process to run the schedule. A full example can be found at <a href="https://github.com/actionhero/node-resque/blob/master/examples/scheduledJobs.ts">/examples/scheduledJobs.ts</a>, but the relevant section is:</p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">NodeResque</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-3">&quot;node-resque&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">schedule</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-3">&quot;node-schedule&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Queue</span><span class="hl-1">({ </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1"> }, </span><span class="hl-2">jobs</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">scheduler</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">Scheduler</span><span class="hl-1">({ </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1"> });</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">();</span><br/><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span><br/><br/><span class="hl-2">schedule</span><span class="hl-1">.</span><span class="hl-5">scheduleJob</span><span class="hl-1">(</span><span class="hl-3">&quot;10,20,30,40,50 * * * * *&quot;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// do this job every 10 seconds, CRON style</span><br/><span class="hl-1">  </span><span class="hl-6">// we want to ensure that only one instance of this job is scheduled in our environment at once,</span><br/><span class="hl-1">  </span><span class="hl-6">// no matter how many schedulers we have running</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">scheduler</span><span class="hl-1">.</span><span class="hl-2">leader</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;&gt;&gt;&gt; enqueuing a job&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">queue</span><span class="hl-1">.</span><span class="hl-5">enqueue</span><span class="hl-1">(</span><span class="hl-3">&quot;time&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;ticktock&quot;</span><span class="hl-1">, </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Date</span><span class="hl-1">().</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="plugins" class="tsd-anchor-link">Plugins<a href="#plugins" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Just like ruby's resque, you can write worker plugins. They look like this. The 4 hooks you have are <code>beforeEnqueue</code>, <code>afterEnqueue</code>, <code>beforePerform</code>, and <code>afterPerform</code>. Plugins are <code>classes</code> which extend <code>NodeResque.Plugin</code></p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-7">Plugin</span><span class="hl-1"> } = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-3">&quot;node-resque&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-9">MyPlugin</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-9">Plugin</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">(...</span><span class="hl-2">args</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">// @ts-ignore</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">(...</span><span class="hl-2">args</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-2">name</span><span class="hl-1"> = </span><span class="hl-3">&quot;MyPlugin&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">beforeEnqueue</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">// console.log(&quot;** beforeEnqueue&quot;)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">; </span><span class="hl-6">// should the job be enqueued?</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">afterEnqueue</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">// console.log(&quot;** afterEnqueue&quot;)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">beforePerform</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">// console.log(&quot;** beforePerform&quot;)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">; </span><span class="hl-6">// should the job be run?</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">afterPerform</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">// console.log(&quot;** afterPerform&quot;)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>And then your plugin can be invoked within a job like this:</p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">jobs</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">add:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">plugins:</span><span class="hl-1"> [</span><span class="hl-2">MyPlugin</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">pluginOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">MyPlugin:</span><span class="hl-1"> { </span><span class="hl-2">thing:</span><span class="hl-1"> </span><span class="hl-3">&quot;stuff&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">perform</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1"> = </span><span class="hl-2">a</span><span class="hl-1"> + </span><span class="hl-2">b</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1">;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>notes</strong></p>
<ul>
<li>You need to return <code>true</code> or <code>false</code> on the before hooks. <code>true</code> indicates that the action should continue, and <code>false</code> prevents it. This is called <code>toRun</code>.</li>
<li>If you are writing a plugin to deal with errors which may occur during your resque job, you can inspect and modify <code>this.worker.error</code> in your plugin. If <code>this.worker.error</code> is null, no error will be logged in the resque error queue.</li>
<li>There are a few included plugins, all in the <code>src/plugins/*</code> directory. You can write your own and include it like this:</li>
</ul>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">jobs</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">add:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">plugins:</span><span class="hl-1"> [</span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-3">&quot;Myplugin&quot;</span><span class="hl-1">).</span><span class="hl-2">Myplugin</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">pluginOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">MyPlugin:</span><span class="hl-1"> { </span><span class="hl-2">thing:</span><span class="hl-1"> </span><span class="hl-3">&quot;stuff&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">perform</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1"> = </span><span class="hl-2">a</span><span class="hl-1"> + </span><span class="hl-2">b</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">answer</span><span class="hl-1">;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>The plugins which are included with this package are:</p>
<ul>
<li><code>DelayQueueLock</code>
<ul>
<li>If a job with the same name, queue, and args is already in the delayed queue(s), do not enqueue it again</li>
</ul>
</li>
<li><code>JobLock</code>
<ul>
<li>If a job with the same name, queue, and args is already running, put this job back in the queue and try later</li>
</ul>
</li>
<li><code>QueueLock</code>
<ul>
<li>If a job with the same name, queue, and args is already in the queue, do not enqueue it again</li>
</ul>
</li>
<li><code>Retry</code>
<ul>
<li>If a job fails, retry it N times before finally placing it into the failed queue</li>
</ul>
</li>
</ul>
<h2 id="multi-worker" class="tsd-anchor-link">Multi Worker<a href="#multi-worker" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p><code>node-resque</code> provides a wrapper around the <code>Worker</code> class which will auto-scale the number of resque workers. This will process more than one job at a time as long as there is idle CPU within the event loop. For example, if you have a slow job that sends email via SMTP (with low overhead), we can process many jobs at a time, but if you have a math-heavy operation, we'll stick to 1. The <code>MultiWorker</code> handles this by spawning more and more node-resque workers and managing the pool.</p>
<pre><code class="javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">NodeResque</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-3">&quot;node-resque&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">connectionDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">pkg:</span><span class="hl-1"> </span><span class="hl-3">&quot;ioredis&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">host:</span><span class="hl-1"> </span><span class="hl-3">&quot;127.0.0.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">password:</span><span class="hl-1"> </span><span class="hl-3">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">multiWorker</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeResque</span><span class="hl-1">.</span><span class="hl-5">MultiWorker</span><span class="hl-1">(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-2">connection:</span><span class="hl-1"> </span><span class="hl-2">connectionDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">queues:</span><span class="hl-1"> [</span><span class="hl-3">&quot;slowQueue&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">minTaskProcessors:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">maxTaskProcessors:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">checkTimeout:</span><span class="hl-1"> </span><span class="hl-8">1000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">maxEventLoopDelay:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">jobs</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">// normal worker emitters</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;start&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] started&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;end&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] ended&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;cleaning_worker&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">worker</span><span class="hl-1">, </span><span class="hl-2">pid</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;cleaning old worker &quot;</span><span class="hl-1"> + </span><span class="hl-2">worker</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;poll&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] polling &quot;</span><span class="hl-1"> + </span><span class="hl-2">queue</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;ping&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">time</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] check in @ &quot;</span><span class="hl-1"> + </span><span class="hl-2">time</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;job&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] working job &quot;</span><span class="hl-1"> + </span><span class="hl-2">queue</span><span class="hl-1"> + </span><span class="hl-3">&quot; &quot;</span><span class="hl-1"> + </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-2">job</span><span class="hl-1">),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;reEnqueue&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">plugin</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">workerId</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;] reEnqueue job (&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">plugin</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;) &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">queue</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-2">job</span><span class="hl-1">),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;success&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">result</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">workerId</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;] job success &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">queue</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-2">job</span><span class="hl-1">) +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &gt;&gt; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">result</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;failure&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">failure</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">workerId</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;] job failure &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">queue</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-2">job</span><span class="hl-1">) +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &gt;&gt; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">failure</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">, </span><span class="hl-2">queue</span><span class="hl-1">, </span><span class="hl-2">job</span><span class="hl-1">, </span><span class="hl-2">error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">workerId</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;] error &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">queue</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-2">job</span><span class="hl-1">) +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; &gt;&gt; &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">error</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;pause&quot;</span><span class="hl-1">, (</span><span class="hl-2">workerId</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;worker[&quot;</span><span class="hl-1"> + </span><span class="hl-2">workerId</span><span class="hl-1"> + </span><span class="hl-3">&quot;] paused&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&quot;multiWorkerAction&quot;</span><span class="hl-1">, (</span><span class="hl-2">verb</span><span class="hl-1">, </span><span class="hl-2">delay</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;*** checked for worker status: &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">verb</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot; (event loop delay: &quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-2">delay</span><span class="hl-1"> +</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;ms)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">multiWorker</span><span class="hl-1">.</span><span class="hl-5">start</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="multiworker-options" class="tsd-anchor-link">MultiWorker Options<a href="#multiworker-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The Options available for the multiWorker are:</p>
<ul>
<li><code>connection</code>: The redis configuration options (same as worker)</li>
<li><code>queues</code>: Array of ordered queue names (or <code>*</code>) (same as worker)</li>
<li><code>minTaskProcessors</code>: The minimum number of workers to spawn under this multiWorker, even if there is no work to do. You need at least one, or no work will ever be processed or checked</li>
<li><code>maxTaskProcessors</code>: The maximum number of workers to spawn under this multiWorker, even if the queues are long and there is available CPU (the event loop isn't entirely blocked) to this node process.</li>
<li><code>checkTimeout</code>: How often to check if the event loop is blocked (in ms) (for adding or removing multiWorker children),</li>
<li><code>maxEventLoopDelay</code>: How long the event loop has to be delayed before considering it blocked (in ms),</li>
</ul>
<h2 id="presentation" class="tsd-anchor-link">Presentation<a href="#presentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>This package was featured heavily in <a href="https://www.evantahler.com/blog/post/2016-05-11-background-tasks-in-nodejs-a-survey-with-redis">this presentation I gave</a> about background jobs + node.js. It contains more examples!</p>
<h2 id="acknowledgments" class="tsd-anchor-link">Acknowledgments<a href="#acknowledgments" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<ul>
<li>Most of this code was inspired by / stolen from <a href="https://npmjs.org/package/coffee-resque">coffee-resque</a> and <a href="https://github.com/leeadkins/coffee-resque-scheduler">coffee-resque-scheduler</a>. Thanks!</li>
<li>This Resque package aims to be fully compatible with <a href="https://github.com/resque/resque">Ruby's Resque</a> and implementations of <a href="https://github.com/resque/resque-scheduler">Resque Scheduler</a>. Other packages from other languages may conflict.</li>
<li>If you are looking for a UI to manage your Resque instances in nodejs, check out <a href="https://github.com/evantahler/ah-resque-ui">ActionHero's Resque UI</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#node-resque-the-best-background-jobs-in-node"><span>node-<wbr/>resque: <wbr/>The best background jobs in node.</span></a><ul><li><a href="#the-resque-factory-how-it-works"><span>The <wbr/>Resque <wbr/>Factory (<wbr/>How <wbr/>It <wbr/>Works)</span></a></li><li><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#queues"><span>Queues</span></a></li><li><a href="#workers"><span>Workers</span></a></li><li><a href="#scheduler"><span>Scheduler</span></a></li></ul></li><li><a href="#api-docs"><span>API <wbr/>Docs</span></a></li><li><a href="#version-notes"><span>Version <wbr/>Notes</span></a></li><li><a href="#usage"><span>Usage</span></a></li><li><a href="#node-resque-interfaces-queue-worker-and-scheduler"><span>Node <wbr/>Resque <wbr/>Interfaces: <wbr/>Queue, <wbr/>Worker, and <wbr/>Scheduler</span></a></li><li><a href="#configuration-options"><span>Configuration <wbr/>Options:</span></a></li><li><a href="#notes"><span>Notes</span></a></li><li><ul><li><a href="#workerperforminline"><span>Worker#perform<wbr/>Inline</span></a></li></ul></li><li><a href="#queue-management"><span>Queue <wbr/>Management</span></a></li><li><a href="#failed-job-management"><span>Failed <wbr/>Job <wbr/>Management</span></a></li><li><ul><li><a href="#failing-a-job"><span>Failing a <wbr/>Job</span></a></li></ul></li><li><a href="#failed-worker-management"><span>Failed <wbr/>Worker <wbr/>Management</span></a></li><li><ul><li><a href="#automatically"><span>Automatically</span></a></li><li><a href="#manually"><span>Manually</span></a></li></ul></li><li><a href="#job-schedules"><span>Job <wbr/>Schedules</span></a></li><li><a href="#plugins"><span>Plugins</span></a></li><li><a href="#multi-worker"><span>Multi <wbr/>Worker</span></a></li><li><ul><li><a href="#multiworker-options"><span>Multi<wbr/>Worker <wbr/>Options</span></a></li></ul></li><li><a href="#presentation"><span>Presentation</span></a></li><li><a href="#acknowledgments"><span>Acknowledgments</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">node-resque</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
